"use strict";(self.webpackChunktahos_lat=self.webpackChunktahos_lat||[]).push([[452],{85452:function(e,a,r){r.r(a),r.d(a,{default:function(){return W}});var d=r(89379),i=r(5544),n=r(64467),t=r(60436),l=r(80045),s=r(9950),o=r(54408),u=r(10300),c=r(83137),m=r(95250),v=r(4297),h=r(49389),p=r(76234),f=r(27162),_=r(65510),A=r(67078),g=r(91212),b=r(10467),w=r(20454),j=r(45131),x=r(93320),q=r(73275),y=r(82109),D=r(88142),M=r(17419),C=r(70298),N=r(70742),F=r(39412),k=r(83325),z=r(49395),I=r(85546),S=r(29714),L=function(e){var a=e.editData,r=e.hasPermission;return(0,d.A)((0,d.A)({},!(null!==a&&void 0!==a&&a.id)&&(0,d.A)({name:"",jmbg:""},r&&{client_name:null})),{},{address:"",phone:"",id_card:null,passport:null,drivers_license:null,cpc:null,hazardous_materials:null,medical_exam:null,card_data_download:null})},P=function(e){var a=e.fieldLabels,r=e.formatMessage,i=e.editData,n=e.hasPermission;return(0,S.Ik)().shape((0,d.A)((0,d.A)({},!(null!==i&&void 0!==i&&i.id)&&(0,d.A)((0,d.A)({},n&&{client_name:(0,S.Ik)().required((0,I.w)(r,a.client_name,"filter"))}),{},{name:(0,S.Yj)().required((0,I.w)(r,a.name,"required")),jmbg:(0,S.Yj)().required((0,I.w)(r,a.jmbg,"required"))})),{},{address:(0,S.Yj)().required((0,I.w)(r,a.address,"required")),phone:(0,S.Yj)().required((0,I.w)(r,a.phone,"required")),id_card:(0,S.p6)().required((0,I.w)(r,a.id_card,"date")),passport:(0,S.p6)().required((0,I.w)(r,a.passport,"date")),drivers_license:(0,S.p6)().required((0,I.w)(r,a.drivers_license,"date")),cpc:(0,S.p6)().required((0,I.w)(r,a.cpc,"date")),hazardous_materials:(0,S.p6)().required((0,I.w)(r,a.hazardous_materials,"date")),medical_exam:(0,S.p6)().required((0,I.w)(r,a.medical_exam,"date")),card_data_download:(0,S.p6)().required((0,I.w)(r,a.card_data_download,"date"))}))},Q=r(44414),Y=["client_name","name","jmbg","id_card","passport","drivers_license","cpc","hazardous_materials","medical_exam","card_data_download"],O=(0,s.memo)((0,o.Ay)(function(e){var a=e.modal,r=e.handleClose,n=e.editData,o=e.fieldLabels,m=e.columns,v=e.dataAll,h=e.setDataAll,p=e.clientId,f=e.intl.formatMessage,_=(0,u.d4)(function(e){return e.login}).spinner,A=(0,u.wA)(),I=function(e){return A(j.yK(e))},S=function(e){return A(j.Lm(e))},O=(0,y.w)({roleNames:["superadmin","admin","podadmin"]}),R=(0,i.A)(O,1)[0],T=(0,D.B)({modal:"add_report"===a,handleClose:r,dataName:"id_driver",editDataID:null===n||void 0===n?void 0:n.id,clientId:p,formatMessage:f}),W=Object.assign({},((0,w.A)(T),T));(0,s.useEffect)(function(){"new"===a&&(null===U||void 0===U||U.handleReset())},[a]);var B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.client_name,r=e.name,i=e.jmbg,t=e.id_card,s=e.passport,o=e.drivers_license,u=e.cpc,m=e.hazardous_materials,v=e.medical_exam,h=e.card_data_download,p=(0,l.A)(e,Y);return(0,d.A)((0,d.A)((0,d.A)({},p),!(null!==n&&void 0!==n&&n.id)&&(0,d.A)((0,d.A)({},R&&{id_client:null===a||void 0===a?void 0:a.id}),{},{name:r,jmbg:i})),{},{id_card:(0,c._b)(t),passport:(0,c._b)(s),drivers_license:(0,c._b)(o),cpc:(0,c._b)(u),hazardous_materials:(0,c._b)(m),medical_exam:(0,c._b)(v),card_data_download:(0,c._b)(h)})},G=function(){var e=(0,b.A)((0,g.A)().m(function e(i){var t,l,s,o,u,m,p,f,_,A,b,w;return(0,g.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(I(!0),l=i&&B(i),o=(null===(t=(s={new:function(){return{url:"/drivers/add.php",postData:l}},edit:function(){return{url:"/drivers/edit.php",postData:(0,d.A)({id:null===n||void 0===n?void 0:n.id},l)}},status:function(){return{url:"/drivers/change_status.php",postData:{id:null===n||void 0===n?void 0:n.id}}}})[a])||void 0===t?void 0:t.call(s))||{},u=o.url,m=o.postData,p=void 0===m?null:m,f=o.actionData,!u){e.n=6;break}return e.p=1,e.n=2,(0,x.c)({method:"POST",query:u,data:p});case 2:_=e.v,A=_.data,b=(0,c.XF)(v,f||(null===A||void 0===A?void 0:A.data),a),h(b),r(),S({serverMessage:null===A||void 0===A?void 0:A.message}),e.n=4;break;case 3:e.p=3,w=e.v,S({serverMessage:(0,c.b6)(w),color:"error"});case 4:return e.p=4,I(!1),e.f(4);case 5:e.n=7;break;case 6:I(!1);case 7:return e.a(2)}},e,null,[[1,3,4,5]])}));return function(a){return e.apply(this,arguments)}}(),H=(0,q.P)({initialValues:L({editData:n,hasPermission:R}),editData:n,validationSchema:P({fieldLabels:o,formatMessage:f,editData:n,hasPermission:R}),onSubmit:G,keyName:"drivers"}),U=H.formik,X=H.renderMultipleInputs,E=H.renderMultipleFilters,K=H.renderMultipleDates,V=(0,s.useMemo)(function(){return[{name:"client_name",refresh:!0,url:"clients/list.php?status=1",label:o.client_name,required:!0}]},[o]),J=(0,s.useMemo)(function(){return[].concat((0,t.A)(null!==n&&void 0!==n&&n.id?[]:[{name:"name",required:!0,label:o.name},{name:"jmbg",required:!0,label:o.jmbg,autoChange:!0,maxLength:13,type:"number"}]),[{name:"address",required:!0,label:o.address},{name:"phone",required:!0,label:o.phone}])},[o,n]),Z=(0,s.useMemo)(function(){return[{name:"id_card",required:!0,label:o.id_card},{name:"passport",required:!0,label:o.passport},{name:"drivers_license",required:!0,label:o.drivers_license},{name:"cpc",required:!0,label:o.cpc},{name:"hazardous_materials",required:!0,label:o.hazardous_materials},{name:"medical_exam",required:!0,label:o.medical_exam},{name:"card_data_download",required:!0,label:o.card_data_download}]},[o]);return function(){var e,i=["new","edit","report","add_report"].includes(a)?M.A:C.A,t={new:function(){return{title:f({id:"button.add"}),message:(0,Q.jsxs)("div",{className:"modalFormGrid",children:[(0,Q.jsxs)("div",{children:[!!R&&E(V),X(J)]}),(0,Q.jsx)("div",{children:K(Z)})]}),footer:(0,Q.jsx)(N.A,{handleSubmit:null===U||void 0===U?void 0:U.handleSubmit,rejectAction:r,spinner:_})}},edit:function(){return{title:f({id:"modal.edit"}),message:(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(F.A,{fieldData:(0,c.Un)({columns:m,editData:n})}),(0,Q.jsxs)("div",{className:"mt-5 modalFormGrid",children:[(0,Q.jsx)("div",{children:X(J)}),(0,Q.jsx)("div",{children:K(Z)})]})]}),footer:(0,Q.jsx)(N.A,{handleSubmit:null===U||void 0===U?void 0:U.handleSubmit,rejectAction:r,spinner:_})}},add_report:function(){return(0,d.A)((0,d.A)({},W),{},{maxWidth:"sm"})},status:function(){return{title:f({id:"modal.status"}),message:(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(F.A,{fieldData:(0,c.Un)({columns:m,editData:n})}),(0,c.GC)({active:null===n||void 0===n?void 0:n.status,formatMessage:f})]}),maxWidth:"md",confirmationHandler:G,confirmButtonType:"primary"}},report:function(){return{title:f({id:"nav.reports"}),message:(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(F.A,{fieldData:(0,c.Un)({columns:m,editData:n})}),(0,Q.jsx)(z.A,{customQuery:"&id_driver=".concat(null===n||void 0===n?void 0:n.id)})]}),maxWidth:"sm",footer:(0,Q.jsx)(k.A,{buttonType:"reset",onClick:r,children:f({id:"button.close"})})}}};return(0,Q.jsx)(i,(0,d.A)({open:!!a,handleClose:r,maxWidth:"md"},null===(e=t[a])||void 0===e?void 0:e.call(t)))}()})),R=["urlQuery"],T=["id_card","passport","drivers_license","cpc","hazardous_materials","medical_exam","card_data_download"],W=(0,s.memo)((0,o.Ay)(function(e){var a=e.clientId,r=e.clientIdQuery,o=void 0===r?"":r,g=e.helmet,b=e.intl.formatMessage,w=(0,u.d4)(function(e){return e.dataTable}).local_query,j=(0,v.c)({clientId:a,clientIdQuery:o,formatMessage:b}),x=j.urlQuery,q=(0,l.A)(j,R),y=(0,m.X)({url:"/drivers/list.php?delay=1".concat(x),hasRefetch:!0,keepQuery:!0}),D=y.data,M=y.setData,C=y.loading,N=(0,s.useMemo)(function(){return(0,c.XH)({responseData:D,itemActiveName:"status",formatingFn:function(e){return Object.assign.apply(Object,[{}].concat((0,t.A)(null===T||void 0===T?void 0:T.map(function(a){return(0,n.A)({},"copy_".concat(a),(0,c._b)(null===e||void 0===e?void 0:e[a],"d.M.yyyy"))}))))},formatMessage:b})},[D,b]),F=(0,s.useState)(null),k=(0,i.A)(F,2),z=k[0],I=k[1],S=(0,s.useState)(!1),L=(0,i.A)(S,2),P=L[0],Y=L[1],W=(0,s.useMemo)(function(){return{id:b({id:"table.number"}),client_name:b({id:"client.name"}),name:b({id:"driver.name"}),jmbg:b({id:"driver.jmbg"}),address:b({id:"driver.address"}),phone:b({id:"driver.phone"}),vehicle:b({id:"nav.vehicles.and.trailers"}),id_card:b({id:"driver.id.card"}),passport:b({id:"driver.passport"}),drivers_license:b({id:"driver.drivers.license"}),cpc:b({id:"driver.cpc"}),hazardous_materials:b({id:"driver.hazardous.materials"}),medical_exam:b({id:"driver.medical.exam"}),card_data_download:b({id:"driver.card.data.download"}),status:b({id:"filter.status"}),alarm_status:b({id:"alarm.status"}),alarm_for_date:b({id:"alarm.for.date"}),has_alarm:b({id:"alarm.status.has"})}},[b]),B=function(){return T.map(function(e){return{field:e,headerName:W[e],width:200,headerAlign:"center",align:"center",renderCell:function(a){var r=a.row,d=(0,c.Yq)(null===r||void 0===r?void 0:r[e],"dateOnly");return(null===r||void 0===r?void 0:r.alarm_fields)===e?(0,Q.jsx)(A.A,{type:"priority",data:{id:5,name:d}}):d}}})},G=(0,s.useMemo)(function(){return[{field:"id",headerName:W.id,width:100,headerAlign:"center",align:"center",infoField:!0},{field:"alarm_count",headerName:W.has_alarm,width:100,headerAlign:"center",align:"center",renderCell:function(e){var a=e.row;return null!==a&&void 0!==a&&a.alarm_count?(0,Q.jsx)(p.A,{customCount:null===a||void 0===a?void 0:a.alarm_count}):"-"},infoField:!0},{field:"name",headerName:W.name,width:250,headerAlign:"center",align:"center",infoField:!0},{field:"jmbg",headerName:W.jmbg,width:180,headerAlign:"center",align:"center",renderCell:function(e){var a=e.row;return(0,Q.jsx)(A.A,{data:{id:1,name:null===a||void 0===a?void 0:a.jmbg}})},infoField:!0},{field:"address",headerName:W.address,width:350,headerAlign:"center",align:"center"},{field:"phone",headerName:W.phone,width:180,headerAlign:"center",align:"center",renderCell:function(e){var a=e.row;return(0,Q.jsx)(A.A,{data:{id:2,name:null===a||void 0===a?void 0:a.phone}})}},{field:"vehicle",headerName:W.vehicle,width:180,headerAlign:"center",align:"center",renderCell:function(e){var a=e.row;return(0,c.NS)({items:null===a||void 0===a?void 0:a.vehicle})}}].concat((0,t.A)(B()),[{field:"status",headerName:W.status,width:200,headerAlign:"center",align:"center",renderCell:function(e){var a=e.row;return(0,Q.jsx)(A.A,{type:"active",data:null===a||void 0===a?void 0:a.status})},infoField:!0}])},[W,c.Yq,B]),H=(0,s.useMemo)(function(){return{new_action:function(){z&&I(null),Y("new")},edit:function(){return Y("edit")},add_report:function(){return Y("add_report")},status:function(){return Y("status")},report:function(){return Y("report")}}},[z]);return(0,Q.jsxs)(Q.Fragment,{children:[null===g||void 0===g?void 0:g(b),(0,Q.jsx)(h.A,(0,d.A)({search_type:"drivers",fieldLabels:W},q)),(0,Q.jsx)(_.A,{hasRefresh:!0,defaultCrudActions:H,disabled:!z}),(0,Q.jsx)(f.A,{autoHeight:!0,isActive:!0,editData:z,loading:C,data:(0,c.CB)(N,w),columns:G,selectRow:I,selectRowDoubleClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(e.modalAction,e.row);I(a),Y("report")}}),(0,Q.jsx)(O,{modal:P,handleClose:function(){Y(!1),z&&I(null)},editData:z,fieldLabels:W,columns:null===G||void 0===G?void 0:G.filter(function(e){return e.infoField}),dataAll:N,setDataAll:M,clientId:a})]})}))}}]);