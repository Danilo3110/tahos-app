"use strict";(self.webpackChunktahos_lat=self.webpackChunktahos_lat||[]).push([[260],{71260:function(e,i,t){t.r(i),t.d(i,{default:function(){return E}});var r=t(89379),a=t(5544),n=t(64467),l=t(60436),o=t(80045),d=t(9950),s=t(54408),u=t(10300),c=t(83137),h=t(95250),m=t(4297),v=t(49389),p=t(76234),f=t(27162),_=t(65510),g=t(67078),A=t(76537),x=t(91212),k=t(10467),b=t(20454),y=t(45131),j=t(93320),w=t(73275),C=t(82109),M=t(88142),I=t(17419),D=t(70298),N=t(70742),L=t(39412),F=t(83325),S=t(49395),q=t(41467),H=t(86878),W=t(20610),P=t(85546),T=t(29714),Y=function(e){var i=e.editData,t=e.hasPermission;return(0,r.A)((0,r.A)({driver:null},!(null!==i&&void 0!==i&&i.id)&&(0,r.A)({type:"",plate:"",make_model:"",photo:null},t&&{client_name:null})),{},{description:"",tech_regular:null,tech_sixth:null,fire_extinguisher:null,first_aid:null,tachograph_calibration:null,tachograph_reading:null,service:null,insurance_kasko:null,registration_expiry:null})},B=function(e){var i=e.fieldLabels,t=e.formatMessage,a=e.editData,n=e.hasPermission;return(0,T.Ik)().shape((0,r.A)({},!(null!==a&&void 0!==a&&a.id)&&(0,r.A)((0,r.A)({type:(0,T.Ik)().required((0,P.w)(t,i.type,"filter")),plate:(0,T.Yj)().required((0,P.w)(t,i.plate,"required"))},n&&{client_name:(0,T.Ik)().required((0,P.w)(t,i.client_name,"filter"))}),{},{make_model:(0,T.Yj)().required((0,P.w)(t,i.make_model,"required"))})))},Q=t(44414),z=["client_name","driver","type","plate","make_model","photo","tech_regular","tech_sixth","fire_extinguisher","first_aid","tachograph_calibration","tachograph_reading","service","insurance_kasko","registration_expiry"],G=(0,d.memo)((0,s.Ay)(function(e){var i=e.modal,t=e.handleClose,n=e.editData,s=e.fieldLabels,h=e.columns,m=e.dataAll,v=e.setDataAll,p=e.clientId,f=e.intl.formatMessage,_=(0,u.d4)(function(e){return e.login}).spinner,g=(0,u.wA)(),A=function(e){return g(y.yK(e))},P=function(e){return g(y.Lm(e))},T=(0,C.w)({roleNames:["superadmin","admin","podadmin"]}),G=(0,a.A)(T,1)[0],O=(0,M.B)({modal:"add_report"===i,handleClose:t,dataName:"id_vehicle",editDataID:null===n||void 0===n?void 0:n.id,clientId:p,formatMessage:f}),R=Object.assign({},((0,b.A)(O),O)),E=(0,d.useState)([]),K=(0,a.A)(E,2),U=K[0],X=K[1];(0,d.useEffect)(function(){"new"===i&&re("photo",U)},[U]),(0,d.useEffect)(function(){"new"===i&&(null===J||void 0===J||J.handleReset(),(null===U||void 0===U?void 0:U.length)&&X([]))},[i]);var V=function(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=i.client_name,a=i.driver,l=i.type,d=i.plate,s=i.make_model,u=i.photo,h=i.tech_regular,m=i.tech_sixth,v=i.fire_extinguisher,p=i.first_aid,f=i.tachograph_calibration,_=i.tachograph_reading,g=i.service,A=i.insurance_kasko,x=i.registration_expiry,k=(0,o.A)(i,z);return(0,r.A)((0,r.A)((0,r.A)({},k),{},{id_driver:null===a||void 0===a?void 0:a.id},!(null!==n&&void 0!==n&&n.id)&&(0,r.A)({type:null===l||void 0===l?void 0:l.value,plate:d,make_model:s,photo:null===u||void 0===u||null===(e=u[0])||void 0===e?void 0:e.src},G&&{id_client:null===t||void 0===t?void 0:t.id})),{},{tech_regular:(0,c._b)(h),tech_sixth:(0,c._b)(m),fire_extinguisher:(0,c._b)(v),first_aid:(0,c._b)(p),tachograph_calibration:(0,c._b)(f),tachograph_reading:(0,c._b)(_),service:(0,c._b)(g),insurance_kasko:(0,c._b)(A),registration_expiry:(0,c._b)(x)})},Z=function(){var e=(0,k.A)((0,x.A)().m(function e(a){var l,o,d,s,u,h,p,f,_,g,k,b,y;return(0,x.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(A(!0),o=a&&V(a),s=(null===(l=(d={new:function(){return{url:"/vehicles/add.php",postData:o,headerType:"multipart"}},edit:function(){return{url:"/vehicles/edit.php",postData:(0,r.A)({id:null===n||void 0===n?void 0:n.id},o)}},status:function(){return{url:"/vehicles/change_status.php",postData:{id:null===n||void 0===n?void 0:n.id}}}})[i])||void 0===l?void 0:l.call(d))||{},u=s.url,h=s.postData,p=void 0===h?null:h,f=s.actionData,_=s.headerType,!u){e.n=6;break}return e.p=1,e.n=2,(0,j.c)({method:"POST",query:u,data:p,headerType:_});case 2:g=e.v,k=g.data,b=(0,c.XF)(m,f||(null===k||void 0===k?void 0:k.data),i),v(b),t(),P({serverMessage:null===k||void 0===k?void 0:k.message}),e.n=4;break;case 3:e.p=3,y=e.v,P({serverMessage:(0,c.b6)(y),color:"error"});case 4:return e.p=4,A(!1),e.f(4);case 5:e.n=7;break;case 6:A(!1);case 7:return e.a(2)}},e,null,[[1,3,4,5]])}));return function(i){return e.apply(this,arguments)}}(),$=(0,w.P)({initialValues:Y({editData:n,hasPermission:G}),editData:n,validationSchema:B({fieldLabels:s,formatMessage:f,editData:n,hasPermission:G}),onSubmit:Z,keyName:"vehicle_trailers"}),J=$.formik,ee=$.renderMultipleInputs,ie=$.renderMultipleFilters,te=$.renderMultipleDates,re=$.setFieldValue,ae=(0,d.useMemo)(function(){return[{name:"client_name",refresh:!0,url:"clients/list.php?status=1",label:s.client_name,required:!0}]},[s]),ne=(0,d.useMemo)(function(){return[{name:"driver",refresh:!0,url:"drivers/list.php?status=1",label:s.driver,customData:!0}].concat((0,l.A)(null!==n&&void 0!==n&&n.id?[]:[{name:"type",options:(0,W.f$)(f),label:s.type,required:!0}]))},[s,n,f]),le=(0,d.useMemo)(function(){return[].concat((0,l.A)(null!==n&&void 0!==n&&n.id?[]:[{name:"plate",required:!0,label:s.plate},{name:"make_model",required:!0,label:s.make_model}]),[{name:"description",label:s.description,multiline:!0,rows:11}])},[s,n]),oe=(0,d.useMemo)(function(){return[{name:"tech_regular",label:s.tech_regular},{name:"tech_sixth",label:s.tech_sixth}]},[s]),de=(0,d.useMemo)(function(){return[{name:"fire_extinguisher",label:s.fire_extinguisher},{name:"first_aid",label:s.first_aid},{name:"tachograph_calibration",label:s.tachograph_calibration},{name:"tachograph_reading",label:s.tachograph_reading},{name:"service",label:s.service},{name:"insurance_kasko",label:s.insurance_kasko},{name:"registration_expiry",label:s.registration_expiry}]},[s]);return function(){var e,a=["new","edit","report","add_report"].includes(i)?I.A:D.A,l={new:function(){var e;return{title:f({id:"button.add"}),message:(0,Q.jsxs)("div",{className:"modalFormGrid",children:[(0,Q.jsxs)("div",{children:[!!G&&ie(ae),ie(ne),ee(le),te(oe),(0,Q.jsx)("div",{className:"mb-4",children:(0,Q.jsx)(q.A,{data:null===(e=(0,H.n)({imageFiles:U,setImageFiles:X,formatMessage:f}))||void 0===e?void 0:e[0]})})]}),(0,Q.jsx)("div",{children:te(de)})]}),footer:(0,Q.jsx)(N.A,{handleSubmit:null===J||void 0===J?void 0:J.handleSubmit,rejectAction:t,spinner:_})}},edit:function(){return{title:f({id:"modal.edit"}),message:(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(L.A,{fieldData:(0,c.Un)({columns:h,editData:n})}),(0,Q.jsxs)("div",{className:"mt-5 modalFormGrid",children:[(0,Q.jsxs)("div",{children:[ie(ne),ee(le),te(oe)]}),(0,Q.jsx)("div",{children:te(de)})]})]}),footer:(0,Q.jsx)(N.A,{handleSubmit:null===J||void 0===J?void 0:J.handleSubmit,rejectAction:t,spinner:_})}},add_report:function(){return(0,r.A)((0,r.A)({},R),{},{maxWidth:"sm"})},status:function(){return{title:f({id:"modal.status"}),message:(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(L.A,{fieldData:(0,c.Un)({columns:h,editData:n})}),(0,c.GC)({active:null===n||void 0===n?void 0:n.status,formatMessage:f})]}),maxWidth:"md",confirmationHandler:Z,confirmButtonType:"primary"}},report:function(){return{title:f({id:"nav.reports"}),message:(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(L.A,{fieldData:(0,c.Un)({columns:h,editData:n})}),(0,Q.jsx)(S.A,{customQuery:"&id_vehicle=".concat(null===n||void 0===n?void 0:n.id)})]}),maxWidth:"sm",footer:(0,Q.jsx)(F.A,{buttonType:"reset",onClick:t,children:f({id:"button.close"})})}}};return(0,Q.jsx)(a,(0,r.A)({open:!!i,handleClose:t,maxWidth:"md"},null===(e=l[i])||void 0===e?void 0:e.call(l)))}()})),O=["urlQuery"],R=["tech_regular","tech_sixth","fire_extinguisher","first_aid","tachograph_calibration","tachograph_reading","service","insurance_kasko","registration_expiry"],E=(0,d.memo)((0,s.Ay)(function(e){var i=e.clientId,t=e.clientIdQuery,s=void 0===t?"":t,x=e.helmet,k=e.intl.formatMessage,b=(0,u.d4)(function(e){return e.dataTable}).local_query,y=(0,m.c)({clientId:i,clientIdQuery:s,formatMessage:k}),j=y.urlQuery,w=(0,o.A)(y,O),C=(0,h.X)({url:"/vehicles/list.php?delay=1".concat(j),hasRefetch:!0,keepQuery:!0}),M=C.data,I=C.setData,D=C.loading,N=(0,d.useMemo)(function(){return(0,c.XH)({responseData:M,itemActiveName:"status",formatingFn:function(e){return Object.assign.apply(Object,[{}].concat((0,l.A)(null===R||void 0===R?void 0:R.map(function(i){return(0,n.A)({},"copy_".concat(i),(0,c._b)(null===e||void 0===e?void 0:e[i],"d.M.yyyy"))}))))},formatMessage:k})},[M,k]),L=(0,d.useState)(null),F=(0,a.A)(L,2),S=F[0],q=F[1],H=(0,d.useState)(!1),W=(0,a.A)(H,2),P=W[0],T=W[1],Y=(0,d.useMemo)(function(){return{id:k({id:"table.number"}),client_name:k({id:"client.name"}),driver:k({id:"nav.drivers"}),type:k({id:"vehicle.type"}),plate:k({id:"vehicle.plate"}),make_model:k({id:"vehicle.make.model"}),photo:k({id:"vehicle.photo"}),description:k({id:"vehicle.description"}),tech_regular:k({id:"vehicle.tech.regular"}),tech_sixth:k({id:"vehicle.tech.sixth"}),fire_extinguisher:k({id:"vehicle.fire.extinguisher"}),first_aid:k({id:"vehicle.first.aid"}),tachograph_calibration:k({id:"vehicle.tachograph.calibration"}),tachograph_reading:k({id:"vehicle.tachograph.reading"}),service:k({id:"vehicle.service"}),insurance_kasko:k({id:"vehicle.insurance.kasko"}),registration_expiry:k({id:"vehicle.registration.expiry"}),status:k({id:"filter.status"}),alarm_status:k({id:"alarm.status"}),alarm_for_date:k({id:"alarm.for.date"}),has_alarm:k({id:"alarm.status.has"})}},[k]),B=function(){return R.map(function(e){return{field:e,headerName:Y[e],width:200,headerAlign:"center",align:"center",renderCell:function(i){var t=i.row,r=(0,c.Yq)(null===t||void 0===t?void 0:t[e],"dateOnly");return(null===t||void 0===t?void 0:t.alarm_fields)===e?(0,Q.jsx)(g.A,{type:"priority",data:{id:5,name:r}}):r}}})},z=(0,d.useMemo)(function(){return[{field:"id",headerName:Y.id,width:100,headerAlign:"center",align:"center",infoField:!0},{field:"alarm_count",headerName:Y.has_alarm,width:100,headerAlign:"center",align:"center",renderCell:function(e){var i=e.row;return null!==i&&void 0!==i&&i.alarm_count?(0,Q.jsx)(p.A,{customCount:null===i||void 0===i?void 0:i.alarm_count}):"-"},infoField:!0},{field:"type",headerName:Y.type,width:200,headerAlign:"center",align:"center",renderCell:function(e){var i=e.row;return(0,Q.jsx)(g.A,{data:{id:1,name:null===i||void 0===i?void 0:i.type}})},infoField:!0},{field:"plate",headerName:Y.plate,width:200,headerAlign:"center",align:"center",renderCell:function(e){var i=e.row;return(0,Q.jsx)(g.A,{data:{id:2,name:null===i||void 0===i?void 0:i.plate}})},infoField:!0},{field:"make_model",headerName:Y.make_model,width:250,headerAlign:"center",align:"center",infoField:!0},{field:"photo",headerName:Y.photo,width:150,headerAlign:"center",align:"center",renderCell:function(e){var i=e.row;return null!==i&&void 0!==i&&i.photo?(0,Q.jsx)(A.A,{avatar:!0,onClick:function(){return window.open((0,c.NY)(null===i||void 0===i?void 0:i.photo),"_blank")},src:(0,c.NY)(null===i||void 0===i?void 0:i.photo),alt:null===i||void 0===i?void 0:i.make_model}):"-"},infoField:!0},{field:"description",headerName:Y.description,width:300,headerAlign:"center",align:"center"},{field:"driver",headerName:Y.driver,width:180,headerAlign:"center",align:"center",renderCell:function(e){var i=e.row;return(0,c.NS)({items:null===i||void 0===i?void 0:i.driver})}}].concat((0,l.A)(B()),[{field:"status",headerName:Y.status,width:200,headerAlign:"center",align:"center",renderCell:function(e){var i=e.row;return(0,Q.jsx)(g.A,{type:"active",data:null===i||void 0===i?void 0:i.status})},infoField:!0}])},[Y,c.Yq,B]),E=(0,d.useMemo)(function(){return{new_action:function(){S&&q(null),T("new")},edit:function(){return T("edit")},add_report:function(){return T("add_report")},status:function(){return T("status")},report:function(){return T("report")}}},[S]);return(0,Q.jsxs)(Q.Fragment,{children:[null===x||void 0===x?void 0:x(k),(0,Q.jsx)(v.A,(0,r.A)({search_type:"vehicles",fieldLabels:Y},w)),(0,Q.jsx)(_.A,{hasRefresh:!0,defaultCrudActions:E,disabled:!S}),(0,Q.jsx)(f.A,{isActive:!0,autoHeight:!0,editData:S,loading:D,data:(0,c.CB)(N,b),columns:z,selectRow:q,selectRowDoubleClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(e.modalAction,e.row);q(i),T("report")}}),(0,Q.jsx)(G,{modal:P,handleClose:function(){T(!1),S&&q(null)},editData:S,fieldLabels:Y,columns:null===z||void 0===z?void 0:z.filter(function(e){return e.infoField}),dataAll:N,setDataAll:I,clientId:i})]})}))},76537:function(e,i,t){t.d(i,{A:function(){return A}});var r=t(89379),a=t(5544),n=t(80045),l=t(9950),o=t(10300);var d=t.p+"static/media/default_avatar_light.211abf6240b228ade1918e872e46f2b9.svg";var s={light:d,dark:t.p+"static/media/default_avatar_dark.cde14e96e1839c56d637339862e68175.svg"},u={container:"CustomImg_container__K--Zu",placeholderImg:"CustomImg_placeholderImg__xcj0M",customImg:"CustomImg_customImg__5HLzn",avatar:"CustomImg_avatar__Ps+HY",noImageIcon:"CustomImg_noImageIcon__pKH2s"},c=t(83137),h=t(46639),m=t(44414),v=["stroke"],p=function(e){var i=e.stroke,t=(0,n.A)(e,v),a=(0,o.d4)(function(e){return e.app}).themeColors,d=(0,l.useMemo)(function(){return i||a["--no-img-color"]},[i,a]);return(0,m.jsxs)("svg",(0,r.A)((0,r.A)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),{},{children:[(0,m.jsx)("path",{d:"M6 10H9",stroke:d,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,m.jsx)("path",{d:"M6.75977 22.0017H17.2398C19.9998 22.0017 21.0998 20.3117 21.2298 18.2517L21.7498 9.99172C21.8098 9.06172 21.5198 8.19172 21.0098 7.51172",stroke:d,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,m.jsx)("path",{d:"M18.0002 6C17.3902 6 16.8302 5.65 16.5502 5.11L15.8302 3.66C15.3702 2.75 14.1702 2 13.1502 2H10.8602C9.83017 2 8.63017 2.75 8.17017 3.66L7.45017 5.11C7.17017 5.65 6.61017 6 6.00017 6C3.83017 6 2.11017 7.83 2.25017 9.99L2.77017 18.25C2.82017 19.07 3.03017 19.84 3.44017 20.46",stroke:d,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,m.jsx)("path",{d:"M10 17.3095C10.55 17.7395 11.25 17.9995 12 17.9995C13.79 17.9995 15.25 16.5395 15.25 14.7495C15.25 14.1095 15.07 13.5195 14.75 13.0195",stroke:d,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,m.jsx)("path",{d:"M22 2L2 22",stroke:d,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}))},f=(0,l.memo)(p),_=["avatar","alt","src","spinnerSize","spinnerColor","style"],g=function(e){var i=e.avatar,t=e.alt,d=e.src,v=void 0===d?"test":d,p=e.spinnerSize,g=void 0===p?40:p,A=e.spinnerColor,x=e.style,k=void 0===x?{}:x,b=(0,n.A)(e,_),y=(0,o.d4)(function(e){return e.app}),j=y.theme,w=y.color,C=(0,l.useState)(!1),M=(0,a.A)(C,2),I=M[0],D=M[1],N=(0,l.useState)(!1),L=(0,a.A)(N,2),F=L[0],S=L[1],q=(0,l.useMemo)(function(){return i?20:g},[i,g]),H=(0,l.useMemo)(function(){return(0,r.A)({opacity:I?"1":"0"},k)},[I,k]);return(0,m.jsxs)("div",{className:u.container,children:[!I&&(0,m.jsx)("div",{className:u.placeholderImg,children:(0,m.jsx)(h.A,{size:q,sx:{color:A||w}})}),F?(0,m.jsx)("div",(0,r.A)((0,r.A)({className:u.noImageIcon},(0,c.BG)({direction:"fade",delay:"200"})),{},{children:(0,m.jsx)(f,{})})):(0,m.jsx)("img",(0,r.A)((0,r.A)({},(0,c.BG)({direction:"fade",delay:"200"})),{},{src:v,onError:function(e){return function(e){i?(D(!1),e.target.onError=null,e.target.src=s[j]||s.light):S(!0),!i&&!I&&D(!0)}(e)},loading:"lazy",onLoad:function(){return D(!0)},alt:t,className:[u.customImg,i?u.avatar:""].join(" "),style:H},b||{}))]})},A=(0,l.memo)(g)}}]);